```
mysql> SELECT player_name, height FROM player WHERE height = (SELECT max(height) FROM player);
+-------------+--------+
| player_name | height |
+-------------+--------+
| 索恩-马克   |   2.16 |
+-------------+--------+
1 row in set (0.01 sec)
```
通过SELECT max(height) FROM player可以得到最高身高这个数值，结果为 2.16，然后我们再通过 player 这个表，看谁具有这个身高，再进行输出，这样的子查询就是**非关联子查询**。

如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为**关联子查询**。

查找每个球队中大于本队平均身高的球员有哪些，并显示他们的球员姓名、身高以及所在球队 ID。
```
mysql> SELECT player_name, height, team_id FROM player AS a WHERE height > (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id);
+-------------------------+--------+---------+
| player_name             | height | team_id |
+-------------------------+--------+---------+
| 安德烈-德拉蒙德         |   2.11 |    1001 |
| 索恩-马克               |   2.16 |    1001 |
| 扎扎-帕楚里亚           |   2.11 |    1001 |
| 乔恩-洛伊尔             |   2.08 |    1001 |
| 布雷克-格里芬           |   2.08 |    1001 |
| 雷吉-巴洛克             |   2.01 |    1001 |
| 斯坦利-约翰逊           |   2.01 |    1001 |
| 亨利-埃伦森             |   2.11 |    1001 |
| 斯维亚托斯拉夫-米凯卢克 |   2.03 |    1001 |
| 博扬-博格达诺维奇       |   2.03 |    1002 |
| 多曼塔斯-萨博尼斯       |   2.11 |    1002 |
| 迈尔斯-特纳             |   2.11 |    1002 |
| 赛迪斯-杨               |   2.03 |    1002 |
| 道格-迈克德莫特         |   2.03 |    1002 |
| TJ-利夫                 |   2.08 |    1002 |
| 凯尔-奥奎因             |   2.08 |    1002 |
| 阿利兹-约翰逊           |   2.06 |    1002 |
| 伊凯·阿尼博古          |   2.08 |    1002 |
+-------------------------+--------+---------+
18 rows in set (0.00 sec)
```

#### EXISTS 子查询
看出场过的球员都有哪些，并且显示他们的姓名、球员 ID 和球队 ID。
```
mysql> SELECT player_id, team_id, player_name FROM player WHERE EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id);
+-----------+---------+-------------------+
| player_id | team_id | player_name       |
+-----------+---------+-------------------+
|     10001 |    1001 | 韦恩-艾灵顿       |
|     10002 |    1001 | 雷吉-杰克逊       |
|     10003 |    1001 | 安德烈-德拉蒙德   |
|     10004 |    1001 | 索恩-马克         |
|     10005 |    1001 | 布鲁斯-布朗       |
|     10006 |    1001 | 兰斯顿-加洛韦     |
|     10007 |    1001 | 格伦-罗宾逊三世   |
|     10008 |    1001 | 伊斯梅尔-史密斯   |
|     10009 |    1001 | 扎扎-帕楚里亚     |
|     10010 |    1001 | 乔恩-洛伊尔       |
|     10022 |    1002 | 博扬-博格达诺维奇 |
|     10023 |    1002 | 多曼塔斯-萨博尼斯 |
|     10024 |    1002 | 迈尔斯-特纳       |
|     10025 |    1002 | 赛迪斯-杨         |
|     10028 |    1002 | 泰瑞克-埃文斯     |
|     10029 |    1002 | 道格-迈克德莫特   |
|     10030 |    1002 | 科里-约瑟夫       |
|     10031 |    1002 | 阿龙-霍勒迪       |
|     10032 |    1002 | TJ-利夫           |
+-----------+---------+-------------------+
19 rows in set (0.00 sec)
```
NOT EXISTS 就是不存在的意思，我们也可以通过 NOT EXISTS 查询不存在于 player_score 表中的球员信息，比如主表中的 player_id 不在子表 player_score 中
```
mysql> SELECT player_id, team_id, player_name FROM player WHERE NOT EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id);
+-----------+---------+-------------------------+
| player_id | team_id | player_name             |
+-----------+---------+-------------------------+
|     10011 |    1001 | 布雷克-格里芬           |
|     10012 |    1001 | 雷吉-巴洛克             |
|     10013 |    1001 | 卢克-肯纳德             |
|     10014 |    1001 | 斯坦利-约翰逊           |
|     10015 |    1001 | 亨利-埃伦森             |
|     10016 |    1001 | 凯里-托马斯             |
|     10017 |    1001 | 何塞-卡尔德隆           |
|     10018 |    1001 | 斯维亚托斯拉夫-米凯卢克 |
|     10019 |    1001 | 扎克-洛夫顿             |
|     10020 |    1001 | 卡林-卢卡斯             |
|     10021 |    1002 | 维克多-奥拉迪波         |
|     10026 |    1002 | 达伦-科里森             |
|     10027 |    1002 | 韦斯利-马修斯           |
|     10033 |    1002 | 凯尔-奥奎因             |
|     10034 |    1002 | 埃德蒙-萨姆纳           |
|     10035 |    1002 | 达文-里德               |
|     10036 |    1002 | 阿利兹-约翰逊           |
|     10037 |    1002 | 伊凯·阿尼博古          |
+-----------+---------+-------------------------+
18 rows in set (0.00 sec)
```

#### 集合比较子查询
集合比较子查询的作用是与另一个查询结果集进行比较，我们可以在子查询中使用 IN、ANY、ALL 和 SOME 操作符，它们的含义和英文意义一样：
![](images/5.png)
出场过的球员都有哪些
```
mysql> SELECT player_id, team_id, player_name FROM player WHERE player_id in (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id);
+-----------+---------+-------------------+
| player_id | team_id | player_name       |
+-----------+---------+-------------------+
|     10001 |    1001 | 韦恩-艾灵顿       |
|     10002 |    1001 | 雷吉-杰克逊       |
|     10003 |    1001 | 安德烈-德拉蒙德   |
|     10004 |    1001 | 索恩-马克         |
|     10005 |    1001 | 布鲁斯-布朗       |
|     10006 |    1001 | 兰斯顿-加洛韦     |
|     10007 |    1001 | 格伦-罗宾逊三世   |
|     10008 |    1001 | 伊斯梅尔-史密斯   |
|     10009 |    1001 | 扎扎-帕楚里亚     |
|     10010 |    1001 | 乔恩-洛伊尔       |
|     10022 |    1002 | 博扬-博格达诺维奇 |
|     10025 |    1002 | 赛迪斯-杨         |
|     10024 |    1002 | 迈尔斯-特纳       |
|     10028 |    1002 | 泰瑞克-埃文斯     |
|     10030 |    1002 | 科里-约瑟夫       |
|     10023 |    1002 | 多曼塔斯-萨博尼斯 |
|     10029 |    1002 | 道格-迈克德莫特   |
|     10031 |    1002 | 阿龙-霍勒迪       |
|     10032 |    1002 | TJ-利夫           |
+-----------+---------+-------------------+
19 rows in set (0.00 sec)
```
查询球员表中，比印第安纳步行者（对应的 team_id 为 1002）中任何一个球员身高高的球员的信息，并且输出他们的球员 ID、球员姓名和球员身高
```
mysql> SELECT player_id, player_name, height FROM player WHERE height > ANY (SELECT height FROM player WHERE team_id = 1002);
+-----------+-------------------------+--------+
| player_id | player_name             | height |
+-----------+-------------------------+--------+
|     10001 | 韦恩-艾灵顿             |   1.93 |
|     10002 | 雷吉-杰克逊             |   1.91 |
|     10003 | 安德烈-德拉蒙德         |   2.11 |
|     10004 | 索恩-马克               |   2.16 |
|     10005 | 布鲁斯-布朗             |   1.96 |
|     10006 | 兰斯顿-加洛韦           |   1.88 |
|     10007 | 格伦-罗宾逊三世         |   1.98 |
|     10009 | 扎扎-帕楚里亚           |   2.11 |
|     10010 | 乔恩-洛伊尔             |   2.08 |
|     10011 | 布雷克-格里芬           |   2.08 |
|     10012 | 雷吉-巴洛克             |   2.01 |
|     10013 | 卢克-肯纳德             |   1.96 |
|     10014 | 斯坦利-约翰逊           |   2.01 |
|     10015 | 亨利-埃伦森             |   2.11 |
|     10016 | 凯里-托马斯             |   1.91 |
|     10017 | 何塞-卡尔德隆           |   1.91 |
|     10018 | 斯维亚托斯拉夫-米凯卢克 |   2.03 |
|     10019 | 扎克-洛夫顿             |   1.93 |
|     10020 | 卡林-卢卡斯             |   1.85 |
|     10021 | 维克多-奥拉迪波         |   1.93 |
|     10022 | 博扬-博格达诺维奇       |   2.03 |
|     10023 | 多曼塔斯-萨博尼斯       |   2.11 |
|     10024 | 迈尔斯-特纳             |   2.11 |
|     10025 | 赛迪斯-杨               |   2.03 |
|     10027 | 韦斯利-马修斯           |   1.96 |
|     10028 | 泰瑞克-埃文斯           |   1.98 |
|     10029 | 道格-迈克德莫特         |   2.03 |
|     10030 | 科里-约瑟夫             |   1.91 |
|     10031 | 阿龙-霍勒迪             |   1.85 |
|     10032 | TJ-利夫                 |   2.08 |
|     10033 | 凯尔-奥奎因             |   2.08 |
|     10034 | 埃德蒙-萨姆纳           |   1.96 |
|     10035 | 达文-里德               |   1.98 |
|     10036 | 阿利兹-约翰逊           |   2.06 |
|     10037 | 伊凯·阿尼博古          |   2.08 |
+-----------+-------------------------+--------+
35 rows in set (0.00 sec)
```
比印第安纳步行者（对应的 team_id 为 1002）中所有球员身高都高的球员的信息，并且输出球员 ID、球员姓名和球员身高
```
mysql> SELECT player_id, player_name, height FROM player WHERE height > ALL (SELECT height FROM player WHERE team_id = 1002);
+-----------+-------------+--------+
| player_id | player_name | height |
+-----------+-------------+--------+
|     10004 | 索恩-马克   |   2.16 |
+-----------+-------------+--------+
1 row in set (0.00 sec)
```
ANY、ALL 关键字必须与一个比较操作符一起使用。因为如果你不使用比较操作符，就起不到集合比较的作用，那么使用 ANY 和 ALL 就没有任何意义。

#### 将子查询作为计算字段
查询每个球队的球员数，也就是对应 team 这张表，我需要查询相同的 team_id 在 player 这张表中所有的球员数量是多少。
```
mysql> SELECT team_name, (SELECT count(*) FROM player WHERE player.team_id = team.team_id) AS player_num FROM team;
+----------------+------------+
| team_name      | player_num |
+----------------+------------+
| 底特律活塞     |         20 |
| 印第安纳步行者 |         17 |
| 亚特兰大老鹰   |          0 |
+----------------+------------+
3 rows in set (0.01 sec)
```

##### test
场均得分大于 20 的球员。场均得分从 player_score 表中获取，同时你需要输出球员的 ID、球员姓名以及所在球队的 ID 信息。
```
mysql> select player_id, player_name, team_id from player where player_id in(select player_id from player_score group by player_id having avg(score)>20);
+-----------+-------------+---------+
| player_id | player_name | team_id |
+-----------+-------------+---------+
|     10001 | 韦恩-艾灵顿 |    1001 |
|     10002 | 雷吉-杰克逊 |    1001 |
+-----------+-------------+---------+
2 rows in set (0.00 sec)
```